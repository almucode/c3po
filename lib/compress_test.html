<!DOCTYPE html>
<script src="buffer.js"></script>
<script src="compress.js"></script>
<script src="png.js"></script>
<script src="testing/assert.js"></script>
<script src="testing/test.js"></script>
<script>
test("Empty to ImageData", () => {
  let imageData = compress.toImageData(new ArrayBuffer(0));
  assert.equal(imageData.width, 1);
  assert.equal(imageData.height, 1);
});

test("To ImageData and back", () => {
  let encoded = new Uint8Array([1, 2, 3, 4, 5]).buffer;
  let imageData = compress.toImageData(encoded);
  let decoded = compress.fromImageData(imageData, encoded.byteLength);
  assert.valuesEqual(new Uint8Array(decoded), new Uint8Array(encoded));
});

asyncTest("Pack and unpack", async () => {
  let encoded = buffer.fromString("Zbłaźń mżystość ględów hiperfunkcją");
  let compressed = await compress.pack(encoded);
  let decoded = await compress.unpack(compressed);
  assert.valuesEqual(new Uint8Array(decoded), new Uint8Array(encoded));
});

asyncTest("Empty data", async () => {
  let empty = new ArrayBuffer(0);
  let compressed = await compress.pack(empty);
  assert.equal(compressed.byteLength, 0);
  let decoded = await compress.pack(compressed);
  assert.equal(decoded.byteLength, 0);
});

asyncTest("Small value optimization", async () => {
  let encoded = buffer.fromString("Eighteencharacters");
  let compressed = await compress.pack(encoded);
  assert.valuesEqual(new Uint8Array(compressed), new Uint8Array(encoded));
  let decoded = await compress.unpack(compressed);
  assert.valuesEqual(new Uint8Array(decoded), new Uint8Array(encoded));
});
</script>
