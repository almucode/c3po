<!DOCTYPE html>
<script src="buffer.js"></script>
<script src="png.js"></script>
<script src="testing/assert.js"></script>
<script src="testing/test.js"></script>
<script>
asyncTest("Empty", async () => {
  let pngData = await png.fromEmpty(1, 1);
  let imageData = await png.toImageData(pngData);
  assert.valuesEqual(imageData.data, [0, 0, 0, 0]);
});

asyncTest("From ImageData and back", async () => {
  let encoded = new ImageData(1, 1);
  encoded.data.set([10, 20, 30, 255], 0);
  let pngData = await png.fromImageData(encoded);
  let decoded = await png.toImageData(pngData);
  assert.valuesEqual(decoded.data, encoded.data);
});

asyncTest("From compressed data", async () => {
  let pngData = await png.fromEmpty(10, 20);
  let compressedData = png.getCompressedData(pngData);
  let fromCompressedData = await png.fromCompressedData(10, 20, compressedData);
  assert.valuesEqual(new Uint8Array(pngData),
                     new Uint8Array(fromCompressedData));
});

asyncTest("Getting width", async () => {
  let pngData = await png.fromEmpty(10, 20);
  assert.equal(png.getWidth(pngData), 10);
});

asyncTest("Getting height", async () => {
  let pngData = await png.fromEmpty(10, 20);
  assert.equal(png.getHeight(pngData), 20);
});

asyncTest("Getting compressed data", async () => {
  let pngData = await png.fromEmpty(10, 20);
  let overheadBytes = png.headerBytes + png.chunkHeaderBytes + png.footerBytes;
  assert.equal(png.getCompressedData(pngData).byteLength,
               pngData.byteLength - overheadBytes);
});
</script>
